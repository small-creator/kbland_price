<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- ë„¤ì´ë²„ ê°€ì´ë“œ ê¸°ë°˜ ìµœì í™”ëœ ë©”íƒ€íƒœê·¸ -->
    
    <!-- í˜ì´ì§€ ì œëª© (ë¸Œëœë“œëª… + í•µì‹¬ ê¸°ëŠ¥) -->
    <title>ì „ì„¸ë³´ì¦ë³´í—˜ ê°€ì…ì¡°ê±´ í™•ì¸ | ë³´ì¦ê¸ˆÂ·ìœµìê¸ˆ ê³„ì‚°ê¸°</title>
    
    <!-- í˜ì´ì§€ ì„¤ëª… (80ì ì´ë‚´, 1-2ê°œ ë¬¸ì¥) -->
    <meta name="description" content="ì „ì„¸ë³´ì¦ë³´í—˜ ê°€ì…ì¡°ê±´ì„ ë³´ì¦ê¸ˆÂ·ìœµìê¸ˆìœ¼ë¡œ ì¦‰ì‹œ í™•ì¸! HUGÂ·SGI ë³´í—˜ ê°€ëŠ¥ì—¬ë¶€ ì§„ë‹¨ ì„œë¹„ìŠ¤">
    
    <!-- í‚¤ì›Œë“œ (ìŠ¤íŒ¸ì„± ì—†ì´ ìì—°ìŠ¤ëŸ½ê²Œ) -->
    <meta name="keywords" content="ì „ì„¸ë³´ì¦ë³´í—˜, ê°€ì…ì¡°ê±´, ë³´ì¦ê¸ˆ, ìœµìê¸ˆ, HUG, SGI, ê³„ì‚°ê¸°, í™•ì¸">
    
    <!-- ì˜¤í”ˆê·¸ë˜í”„ íƒœê·¸ (ì†Œì…œ ê³µìœ  + ë„¤ì´ë²„ ê²€ìƒ‰ í™œìš©) -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="ì „ì„¸ë³´ì¦ë³´í—˜ ê°€ì…ì¡°ê±´ í™•ì¸ | ë³´ì¦ê¸ˆÂ·ìœµìê¸ˆ ê³„ì‚°ê¸°">
    <meta property="og:description" content="ì „ì„¸ë³´ì¦ë³´í—˜ ê°€ì…ì¡°ê±´ì„ ë³´ì¦ê¸ˆÂ·ìœµìê¸ˆìœ¼ë¡œ ì¦‰ì‹œ í™•ì¸! HUGÂ·SGI ë³´í—˜ ê°€ëŠ¥ì—¬ë¶€ ì§„ë‹¨ ì„œë¹„ìŠ¤">
    <meta property="og:image" content="https://jeonse-insurance-check.vercel.app/og-image.png">
    <meta property="og:url" content="https://jeonse-insurance-check.vercel.app/">
    <meta property="og:site_name" content="ì „ì„¸ë³´ì¦ë³´í—˜ í™•ì¸ì‹œìŠ¤í…œ">
    <meta property="og:locale" content="ko_KR">
    
    <!-- íŠ¸ìœ„í„° ì¹´ë“œ -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ì „ì„¸ë³´ì¦ë³´í—˜ ê°€ì…ì¡°ê±´ í™•ì¸">
    <meta name="twitter:description" content="ë³´ì¦ê¸ˆÂ·ìœµìê¸ˆìœ¼ë¡œ HUGÂ·SGI ì „ì„¸ë³´ì¦ë³´í—˜ ê°€ì… ê°€ëŠ¥ì—¬ë¶€ë¥¼ ì¦‰ì‹œ í™•ì¸í•˜ì„¸ìš”">
    <meta name="twitter:image" content="https://jeonse-insurance-check.vercel.app/og-image.png">
    <meta name="twitter:domain" content="ì „ì„¸ë³´ì¦ë³´í—˜ í™•ì¸ì‹œìŠ¤í…œ">
    
    <!-- ê²€ìƒ‰ì—”ì§„ ìµœì í™” -->
    <meta name="robots" content="index, follow">
    <meta name="author" content="ê³µì¸ì¤‘ê°œì‚¬">
    <meta name="language" content="ko-KR">
    <meta name="geo.region" content="KR">
    <meta name="geo.placename" content="Korea">
    
    <!-- ë„¤ì´ë²„ ì„œì¹˜ì–´ë“œë°”ì´ì € ì¸ì¦ -->
    <meta name="naver-site-verification" content="28e607070335 7b97653a5a898593ee709c031c83">
    
    <!-- êµ¬ê¸€ ì„œì¹˜ì½˜ì†” ì¸ì¦ (ë“±ë¡ í›„ ì½”ë“œ ì…ë ¥) -->
    <meta name="google-site-verification" content="DLgZhh6tw9ORfVH0KGjGeoDEfVOfmg-OtJu6L6zXDy4">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://jeonse-insurance-check.vercel.app/">
    
    <!-- íŒŒë¹„ì½˜ -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <!-- êµ¬ì¡°í™” ë°ì´í„° (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "ì „ì„¸ë³´ì¦ë³´í—˜ ê°€ì…ì¡°ê±´ í™•ì¸ì‹œìŠ¤í…œ",
        "alternateName": ["ì „ì„¸ë³´ì¦ë³´í—˜ í™•ì¸", "ì „ì„¸ë³´í—˜ ê³„ì‚°ê¸°", "HUG SGI ë³´í—˜í™•ì¸"],
        "description": "ì „ì„¸ë³´ì¦ë³´í—˜ ê°€ì…ì¡°ê±´ì„ ë³´ì¦ê¸ˆê³¼ ìœµìê¸ˆìœ¼ë¡œ ì¦‰ì‹œ í™•ì¸í•˜ëŠ” ë¬´ë£Œ ì„œë¹„ìŠ¤",
        "url": "https://jeonse-insurance-check.vercel.app/",
        "applicationCategory": "FinanceApplication",
        "operatingSystem": "Web Browser",
        "inLanguage": "ko-KR",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "KRW",
            "description": "ë¬´ë£Œ ì „ì„¸ë³´ì¦ë³´í—˜ ê°€ì…ì¡°ê±´ í™•ì¸ ì„œë¹„ìŠ¤"
        },
        "featureList": [
            "ì „ì„¸ë³´ì¦ë³´í—˜ ê°€ì…ì¡°ê±´ í™•ì¸",
            "ë³´ì¦ê¸ˆ ë° ìœµìê¸ˆ ê³„ì‚°",
            "HUG, SGI ë³´ì¦ë³´í—˜ ë¹„êµ",
            "ì¦‰ì‹œ ê°€ì… ê°€ëŠ¥ì—¬ë¶€ ì§„ë‹¨"
        ],
        "publisher": {
            "@type": "Organization",
            "name": "ì „ì„¸ë³´ì¦ë³´í—˜ í™•ì¸ì‹œìŠ¤í…œ"
        },
        "potentialAction": {
            "@type": "UseAction",
            "target": "https://jeonse-insurance-check.vercel.app/",
            "object": "ì „ì„¸ë³´ì¦ë³´í—˜ ê°€ì…ì¡°ê±´ í™•ì¸"
        }
    }
    </script>

    <style>
        /* ê¸°ì¡´ CSSëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ */
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .search-section {
            padding: 40px;
        }

        .search-row {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-group {
            flex: 1;
            min-width: 200px;
        }

        .search-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .search-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 1rem;
            background: white;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }

        .search-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .search-group select:disabled {
            background-color: #f9fafb;
            color: #9ca3af;
            cursor: not-allowed;
        }

        .btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }

        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .results-section {
            margin-top: 30px;
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 15px;
            background: #f8fafc;
            display: none;
        }

        .results-section.show {
            display: block;
        }

        .complex-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .complex-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .complex-item:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
        }

        .complex-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 10px;
        }

        .complex-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: #6b7280;
        }

        .price-info {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            margin-top: 10px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #e5e7eb;
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .price-detail-section {
            margin-top: 30px;
            padding: 25px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: none;
        }

        .price-detail-section.show {
            display: block;
        }

        .price-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .price-table th,
        .price-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #e5e7eb;
        }

        .price-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
        }

        .price-table tr:hover {
            background: #f8fafc;
        }

        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 16px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .success-message {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #166534;
            padding: 16px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .loan-check-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loan-check-modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            position: relative;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .modal-header h3 {
            color: #1f2937;
            margin-bottom: 10px;
        }

        .selected-price {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .input-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .input-hint {
            font-size: 0.85rem;
            color: #6b7280;
            margin-top: 5px;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn.primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .modal-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(16, 185, 129, 0.3);
        }

        .modal-btn.secondary {
            background: #f3f4f6;
            color: #374151;
        }

        .modal-btn.secondary:hover {
            background: #e5e7eb;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6b7280;
            cursor: pointer;
            padding: 5px;
        }

        .close-btn:hover {
            color: #374151;
        }

        .result-section {
            margin-top: 25px;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .result-section.success {
            background: #f0fdf4;
            border: 2px solid #bbf7d0;
            color: #166534;
        }

        .result-section.warning {
            background: #fffbeb;
            border: 2px solid #fed7aa;
            color: #ea580c;
        }

        .result-section.error {
            background: #fef2f2;
            border: 2px solid #fecaca;
            color: #dc2626;
        }

        .result-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .result-details {
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .price-clickable {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .price-clickable:hover {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            .search-row {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .search-section {
                padding: 20px;
            }
            
            .complex-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ  ì „ì„¸ë³´ì¦ë³´í—˜ ê°€ì…ì¡°ê±´ í™•ì¸ì‹œìŠ¤í…œ</h1>
            <p>ë³´ì¦ê¸ˆÂ·ìœµìê¸ˆìœ¼ë¡œ HUG, SGI ì „ì„¸ë³´ì¦ë³´í—˜ ê°€ì… ê°€ëŠ¥ì—¬ë¶€ë¥¼ ì¦‰ì‹œ í™•ì¸í•˜ì„¸ìš”</p>
        </div>

        <div class="search-section">
            <!-- ì§€ì—­ ì„ íƒ -->
            <div class="search-row">
                <div class="search-group">
                    <label for="region-select">ì§€ì—­ ì„ íƒ</label>
                    <select id="region-select">
                        <option value="">ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <div class="search-group">
                    <label for="district-select">ì‹œ/êµ¬/êµ°</label>
                    <select id="district-select" disabled>
                        <option value="">ì§€ì—­ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <div class="search-group">
                    <label for="dong-select">ì/ë©´/ë™</label>
                    <select id="dong-select" disabled>
                        <option value="">ì‹œ/êµ¬/êµ°ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
            </div>

            <!-- ë‹¨ì§€ ì„ íƒ -->
            <div class="search-row">
                <div class="search-group" style="flex: 3;">
                    <label for="complex-select">ë‹¨ì§€ëª… ì„ íƒ</label>
                    <select id="complex-select" disabled>
                        <option value="">ì/ë©´/ë™ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <div class="search-group">
                    <label>&nbsp;</label>
                    <button class="btn" onclick="searchPrices()" id="search-btn" disabled>
                        ì‹œì„¸ ì¡°íšŒ
                    </button>
                </div>
            </div>

            <!-- ê²€ìƒ‰ ê²°ê³¼ -->
            <div id="results-section" class="results-section">
                <h3>ğŸ¢ ë‹¨ì§€ ëª©ë¡</h3>
                <div id="complex-list" class="complex-grid"></div>
            </div>

            <!-- ì‹œì„¸ ìƒì„¸ -->
            <div id="price-detail-section" class="price-detail-section">
                <div id="price-detail-content"></div>
            </div>
        </div>
    </div>

    <!-- ë³´ì¦ë³´í—˜ í™•ì¸ ëª¨ë‹¬ -->
    <div id="loan-check-modal" class="loan-check-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeLoanModal()">&times;</button>
            
            <div class="modal-header">
                <h3>ğŸ›¡ï¸ ë³´ì¦ë³´í—˜ ê°€ì…ì—¬ë¶€ í™•ì¸</h3>
                <div class="selected-price" id="modal-selected-price">
                    ì„ íƒëœ ë§¤ë§¤ê°€: 0ì–µ
                </div>
                <div style="margin-top: 10px; font-size: 0.9rem; color: #6b7280;">
                    <span id="modal-property-info">ë©´ì : - | í‰ìˆ˜: - | íƒ€ì…: -</span>
                </div>
            </div>

            <div class="input-group">
                <label for="deposit-input">ë³´ì¦ê¸ˆ (ë§Œì›)</label>
                <input type="number" id="deposit-input" placeholder="ì˜ˆ: 25000" step="100" min="0">
                <div class="input-hint">ë³´ì¦ê¸ˆì„ ë§Œì› ë‹¨ìœ„ë¡œ ì…ë ¥í•˜ì„¸ìš”</div>
                <div id="deposit-display" style="margin-top: 5px; font-size: 0.9rem; color: #059669; font-weight: 600;"></div>
            </div>

            <div class="input-group">
                <label for="loan-input">ìœµìê¸ˆ (ë§Œì›)</label>
                <input type="number" id="loan-input" placeholder="ì˜ˆ: 120000" step="100" min="0">
                <div class="input-hint">ìœµìë°›ì„ ê¸ˆì•¡ì„ ë§Œì› ë‹¨ìœ„ë¡œ ì…ë ¥í•˜ì„¸ìš”</div>
                <div id="loan-display" style="margin-top: 5px; font-size: 0.9rem; color: #2563eb; font-weight: 600;"></div>
            </div>

            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeLoanModal()">ì·¨ì†Œ</button>
                <button class="modal-btn primary" onclick="checkInsuranceEligibility()">ë³´ì¦ë³´í—˜ ê°€ì…ì—¬ë¶€ í™•ì¸</button>
            </div>

            <div id="loan-result" class="result-section" style="display: none;"></div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let dongcodeData = {};
        let currentComplexes = [];
        let selectedComplex = null;
        let selectedPriceValue = 0;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ, ì´ˆê¸°í™” ì‹œì‘...');
            loadDongcodeData();
        });

        // JSON ë°ì´í„° ë¡œë“œ
        async function loadDongcodeData() {
            console.log('ğŸ“‚ JSON ë°ì´í„° ë¡œë”© ì‹œì‘...');
            
            try {
                // 1. í†µí•© íŒŒì¼ ë¨¼ì € ì‹œë„
                console.log('ğŸ” í†µí•© íŒŒì¼ ì‹œë„: ./static/combined_dongcode_data.json');
                let response = await fetch('./static/combined_dongcode_data.json');
                
                if (response.ok) {
                    let data = await response.json();
                    console.log('âœ… í†µí•© íŒŒì¼ ë¡œë“œ ì„±ê³µ:', data);
                    dongcodeData = data.regions || {};
                    
                    if (Object.keys(dongcodeData).length > 0) {
                        console.log('ğŸ“Š ë¡œë“œëœ ì§€ì—­ ë°ì´í„°:', Object.keys(dongcodeData));
                        populateRegions();
                        return;
                    }
                }
                
                console.log('âš ï¸ í†µí•© íŒŒì¼ ì‹¤íŒ¨, ê°œë³„ íŒŒì¼ ì‹œë„...');
                
                // 2. ê°œë³„ íŒŒì¼ë“¤ ë¡œë“œ
                const files = [
                    './static/ì„œìš¸_dongcode_data.json', 
                    './static/ê²½ê¸°ë„_dongcode_data.json'
                ];
                
                for (const file of files) {
                    try {
                        console.log(`ğŸ” ê°œë³„ íŒŒì¼ ì‹œë„: ${file}`);
                        const response = await fetch(file);
                        if (response.ok) {
                            const data = await response.json();
                            console.log(`âœ… ${file} ë¡œë“œ ì„±ê³µ:`, data);
                            Object.assign(dongcodeData, data.regions || {});
                        } else {
                            console.log(`âŒ ${file} ë¡œë“œ ì‹¤íŒ¨: ${response.status}`);
                        }
                    } catch (e) {
                        console.log(`âŒ ${file} ì˜¤ë¥˜:`, e);
                    }
                }
                
                if (Object.keys(dongcodeData).length > 0) {
                    console.log('ğŸ“Š ìµœì¢… ë¡œë“œëœ ì§€ì—­ ë°ì´í„°:', Object.keys(dongcodeData));
                    populateRegions();
                } else {
                    console.error('âŒ ëª¨ë“  JSON íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨');
                    createTestData();
                }
                
            } catch (error) {
                console.error('âŒ JSON ë¡œë“œ ì „ì²´ ì‹¤íŒ¨:', error);
                createTestData();
            }
        }

        // í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
        function createTestData() {
            console.log('ğŸ§ª í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì¤‘...');
            
            dongcodeData = {
                "ì„œìš¸íŠ¹ë³„ì‹œ": {
                    "districts": {
                        "ê°•ë‚¨êµ¬": {
                            "dong_count": 14,
                            "dongs": {
                                "ëŒ€ì¹˜ë™": {
                                    "code": "1168010600",
                                    "fullName": "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ëŒ€ì¹˜ë™"
                                },
                                "ì—­ì‚¼ë™": {
                                    "code": "1168010100", 
                                    "fullName": "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™"
                                },
                                "ì²­ë‹´ë™": {
                                    "code": "1168010400",
                                    "fullName": "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ì²­ë‹´ë™"
                                }
                            }
                        },
                        "ì„œì´ˆêµ¬": {
                            "dong_count": 10,
                            "dongs": {
                                "ë°˜í¬ë™": {
                                    "code": "1165010700",
                                    "fullName": "ì„œìš¸íŠ¹ë³„ì‹œ ì„œì´ˆêµ¬ ë°˜í¬ë™"
                                },
                                "ì„œì´ˆë™": {
                                    "code": "1165010800",
                                    "fullName": "ì„œìš¸íŠ¹ë³„ì‹œ ì„œì´ˆêµ¬ ì„œì´ˆë™"
                                }
                            }
                        }
                    }
                },
                "ê²½ê¸°ë„": {
                    "districts": {
                        "ì„±ë‚¨ì‹œ": {
                            "dong_count": 15,
                            "dongs": {
                                "ì •ìë™": {
                                    "code": "4113510900",
                                    "fullName": "ê²½ê¸°ë„ ì„±ë‚¨ì‹œ ë¶„ë‹¹êµ¬ ì •ìë™"
                                },
                                "ì„œí˜„ë™": {
                                    "code": "4113511000",
                                    "fullName": "ê²½ê¸°ë„ ì„±ë‚¨ì‹œ ë¶„ë‹¹êµ¬ ì„œí˜„ë™"
                                }
                            }
                        }
                    }
                }
            };
            
            console.log('âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì™„ë£Œ:', dongcodeData);
            populateRegions();
            showError('JSON íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ì„œ í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. static/ í´ë”ì— JSON íŒŒì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
        }

        // ì§€ì—­ ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
        function populateRegions() {
            console.log('ğŸ”„ ì§€ì—­ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™” ì¤‘...');
            
            const regionSelect = document.getElementById('region-select');
            
            if (!regionSelect) {
                console.error('âŒ region-select ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }
            
            regionSelect.innerHTML = '';
            
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”';
            regionSelect.appendChild(defaultOption);
            
            console.log('ğŸ“Š ì‚¬ìš© ê°€ëŠ¥í•œ ì§€ì—­:', Object.keys(dongcodeData));
            
            Object.keys(dongcodeData).forEach(region => {
                console.log(`â• ì§€ì—­ ì¶”ê°€: ${region}`);
                const option = document.createElement('option');
                option.value = region;
                option.textContent = region;
                regionSelect.appendChild(option);
            });
            
            console.log('âœ… ì§€ì—­ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™” ì™„ë£Œ');
            
            if (regionSelect.children.length > 1) {
                regionSelect.disabled = false;
                console.log('âœ… ì§€ì—­ ì„ íƒ í™œì„±í™”ë¨');
            } else {
                console.warn('âš ï¸ ì§€ì—­ ì˜µì…˜ì´ ì¶”ê°€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
            }
        }

        // ì§€ì—­ ì„ íƒ ì‹œ êµ¬/ì‹œ ì—…ë°ì´íŠ¸
        document.getElementById('region-select').addEventListener('change', function() {
            const selectedRegion = this.value;
            const districtSelect = document.getElementById('district-select');
            const dongSelect = document.getElementById('dong-select');
            const complexSelect = document.getElementById('complex-select');
            
            districtSelect.innerHTML = '<option value="">ì‹œ/êµ¬/êµ°ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            dongSelect.innerHTML = '<option value="">ì/ë©´/ë™ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            complexSelect.innerHTML = '<option value="">ë‹¨ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
            
            dongSelect.disabled = true;
            complexSelect.disabled = true;
            document.getElementById('search-btn').disabled = true;
            
            if (selectedRegion) {
                districtSelect.disabled = false;
                
                const districts = dongcodeData[selectedRegion]?.districts || {};
                // ê°€ë‚˜ë‹¤ë¼ ìˆœìœ¼ë¡œ ì •ë ¬
                const sortedDistricts = Object.keys(districts).sort((a, b) => a.localeCompare(b, 'ko-KR'));
                
                sortedDistricts.forEach(district => {
                    const option = document.createElement('option');
                    option.value = district;
                    option.textContent = district;
                    districtSelect.appendChild(option);
                });
            } else {
                districtSelect.disabled = true;
            }
            
            hideResults();
        });

        // êµ¬/ì‹œ ì„ íƒ ì‹œ ë™ ì—…ë°ì´íŠ¸
        document.getElementById('district-select').addEventListener('change', function() {
            const selectedRegion = document.getElementById('region-select').value;
            const selectedDistrict = this.value;
            const dongSelect = document.getElementById('dong-select');
            const complexSelect = document.getElementById('complex-select');
            
            dongSelect.innerHTML = '<option value="">ì/ë©´/ë™ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            complexSelect.innerHTML = '<option value="">ë‹¨ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
            complexSelect.disabled = true;
            document.getElementById('search-btn').disabled = true;
            
            if (selectedDistrict) {
                dongSelect.disabled = false;
                
                const dongs = dongcodeData[selectedRegion]?.districts[selectedDistrict]?.dongs || {};
                // ê°€ë‚˜ë‹¤ë¼ ìˆœìœ¼ë¡œ ì •ë ¬
                const sortedDongs = Object.keys(dongs).sort((a, b) => a.localeCompare(b, 'ko-KR'));
                
                sortedDongs.forEach(dong => {
                    const option = document.createElement('option');
                    option.value = dong;
                    option.textContent = dong;
                    dongSelect.appendChild(option);
                });
            } else {
                dongSelect.disabled = true;
            }
            
            hideResults();
        });

        // ë™ ì„ íƒ ì‹œ ë‹¨ì§€ ëª©ë¡ ë¡œë“œ
        document.getElementById('dong-select').addEventListener('change', function() {
            const selectedRegion = document.getElementById('region-select').value;
            const selectedDistrict = document.getElementById('district-select').value;
            const selectedDong = this.value;
            const complexSelect = document.getElementById('complex-select');
            
            complexSelect.innerHTML = '<option value="">ë‹¨ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
            document.getElementById('search-btn').disabled = true;
            
            if (selectedDong) {
                const dongCode = dongcodeData[selectedRegion]?.districts[selectedDistrict]?.dongs[selectedDong]?.code;
                
                if (dongCode) {
                    loadComplexes(dongCode);
                }
            } else {
                complexSelect.disabled = true;
            }
            
            hideResults();
        });

        // ë‹¨ì§€ ì„ íƒ ì‹œ ê²€ìƒ‰ ë²„íŠ¼ í™œì„±í™”
        document.getElementById('complex-select').addEventListener('change', function() {
            const searchBtn = document.getElementById('search-btn');
            searchBtn.disabled = !this.value;
        });

        // ë‹¨ì§€ ëª©ë¡ ë¡œë“œ
        async function loadComplexes(dongCode) {
            const complexSelect = document.getElementById('complex-select');
            
            try {
                complexSelect.innerHTML = '<option value="">ë¡œë”© ì¤‘...</option>';
                complexSelect.disabled = true;
                
                console.log(`ğŸ” ë‹¨ì§€ ì¡°íšŒ ì‹œì‘: ë²•ì •ë™ì½”ë“œ ${dongCode}`);
                
                let complexes = [];
                
                try {
                    // ì‹¤ì œ API í˜¸ì¶œ ì‹œë„
                    const response = await fetch(`https://api.kbland.kr/land-price/price/fastPriceInfo?ë²•ì •ë™ì½”ë“œ=${dongCode}&ìœ í˜•=1&ê±°ë˜ìœ í˜•=0`, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json, text/plain, */*',
                            'Accept-Language': 'ko-KR,ko;q=0.9',
                            'Cache-Control': 'no-cache',
                            'Origin': 'https://kbland.kr',
                            'Referer': 'https://kbland.kr/'
                        },
                        mode: 'cors'
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        complexes = data.dataBody?.data || [];
                        console.log(`âœ… API ì§ì ‘ í˜¸ì¶œ ì„±ê³µ: ${complexes.length}ê°œ ë‹¨ì§€`);
                    }
                } catch (corsError) {
                    console.log('âš ï¸ CORS ì˜¤ë¥˜ë¡œ API ì§ì ‘ í˜¸ì¶œ ì‹¤íŒ¨, í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚¬ìš©');
                    complexes = getTestComplexes(dongCode);
                    console.log(`ğŸ§ª í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚¬ìš©: ${complexes.length}ê°œ ë‹¨ì§€`);
                }
                
                currentComplexes = complexes;
                
                complexSelect.innerHTML = '<option value="">ë‹¨ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                
                if (complexes.length > 0) {
                    // ë‹¨ì§€ëª…ìœ¼ë¡œ ì •ë ¬ (ìˆ«ì ê³ ë ¤)
                    const sortedComplexes = [...complexes].sort((a, b) => {
                        const nameA = a.ë‹¨ì§€ëª… || a.name || 'ì´ë¦„ ì—†ìŒ';
                        const nameB = b.ë‹¨ì§€ëª… || b.name || 'ì´ë¦„ ì—†ìŒ';
                        
                        // ë‹¨ì§€ëª…ì—ì„œ ê¸°ë³¸ ì´ë¦„ê³¼ ìˆ«ì ë¶„ë¦¬
                        const parseComplex = (name) => {
                            const match = name.match(/^(.+?)(\d+)(.*)$/);
                            if (match) {
                                return {
                                    baseName: match[1],
                                    number: parseInt(match[2]),
                                    suffix: match[3]
                                };
                            }
                            return { baseName: name, number: 0, suffix: '' };
                        };
                        
                        const parsedA = parseComplex(nameA);
                        const parsedB = parseComplex(nameB);
                        
                        // 1ì°¨: ê¸°ë³¸ ì´ë¦„ìœ¼ë¡œ ì •ë ¬
                        const baseCompare = parsedA.baseName.localeCompare(parsedB.baseName, 'ko-KR');
                        if (baseCompare !== 0) return baseCompare;
                        
                        // 2ì°¨: ìˆ«ìë¡œ ì •ë ¬
                        return parsedA.number - parsedB.number;
                    });
                    
                    sortedComplexes.forEach((complex, index) => {
                        const option = document.createElement('option');
                        option.value = complexes.indexOf(complex); // ì›ë³¸ ë°°ì—´ì—ì„œì˜ ì¸ë±ìŠ¤ ìœ ì§€
                        option.textContent = complex.ë‹¨ì§€ëª… || complex.name || 'ì´ë¦„ ì—†ìŒ';
                        complexSelect.appendChild(option);
                    });
                    
                    complexSelect.disabled = false;
                    console.log(`âœ… ë‹¨ì§€ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${complexes.length}ê°œ`);
                } else {
                    complexSelect.innerHTML = '<option value="">í•´ë‹¹ ì§€ì—­ì— ë‹¨ì§€ê°€ ì—†ìŠµë‹ˆë‹¤</option>';
                    console.log('âš ï¸ ë‹¨ì§€ ì—†ìŒ');
                }
                
            } catch (error) {
                console.error('âŒ ë‹¨ì§€ ë¡œë“œ ì „ì²´ ì˜¤ë¥˜:', error);
                complexSelect.innerHTML = '<option value="">ë‹¨ì§€ ë¡œë“œ ì‹¤íŒ¨</option>';
                showError('ë‹¨ì§€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. CORS ë¬¸ì œì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            }
        }

        // í…ŒìŠ¤íŠ¸ ë‹¨ì§€ ë°ì´í„° ìƒì„±
        function getTestComplexes(dongCode) {
            const testData = {
                "1168010600": [ // ëŒ€ì¹˜ë™
                    {
                        "ë‹¨ì§€ëª…": "ëŒ€ì¹˜ì•„ì´íŒŒí¬",
                        "ë‹¨ì§€ê¸°ë³¸ì¼ë ¨ë²ˆí˜¸": "341954",
                        "ì„¸ëŒ€ìˆ˜": 848,
                        "ì¤€ê³µë…„ë„": "2007",
                        "ë§¤ë§¤í‰ê· ê°€": "148750",
                        "wgs84ìœ„ë„": 37.494567,
                        "wgs84ê²½ë„": 127.059123
                    },
                    {
                        "ë‹¨ì§€ëª…": "ëŒ€ì¹˜ìš°ì„±ì•„íŒŒíŠ¸",
                        "ë‹¨ì§€ê¸°ë³¸ì¼ë ¨ë²ˆí˜¸": "341955",
                        "ì„¸ëŒ€ìˆ˜": 420,
                        "ì¤€ê³µë…„ë„": "1995",
                        "ë§¤ë§¤í‰ê· ê°€": "125000"
                    },
                    {
                        "ë‹¨ì§€ëª…": "ëŒ€ì¹˜í˜„ëŒ€2ì°¨ì•„íŒŒíŠ¸",
                        "ë‹¨ì§€ê¸°ë³¸ì¼ë ¨ë²ˆí˜¸": "341956",
                        "ì„¸ëŒ€ìˆ˜": 756,
                        "ì¤€ê³µë…„ë„": "1993",
                        "ë§¤ë§¤í‰ê· ê°€": "135000"
                    }
                ],
                "1168010100": [ // ì—­ì‚¼ë™
                    {
                        "ë‹¨ì§€ëª…": "ì—­ì‚¼ë¡¯ë°ìºìŠ¬",
                        "ë‹¨ì§€ê¸°ë³¸ì¼ë ¨ë²ˆí˜¸": "341960",
                        "ì„¸ëŒ€ìˆ˜": 580,
                        "ì¤€ê³µë…„ë„": "2005",
                        "ë§¤ë§¤í‰ê· ê°€": "142000"
                    }
                ],
                "1165010700": [ // ë°˜í¬ë™
                    {
                        "ë‹¨ì§€ëª…": "ë°˜í¬ìì´",
                        "ë‹¨ì§€ê¸°ë³¸ì¼ë ¨ë²ˆí˜¸": "341970",
                        "ì„¸ëŒ€ìˆ˜": 1200,
                        "ì¤€ê³µë…„ë„": "2009",
                        "ë§¤ë§¤í‰ê· ê°€": "165000"
                    }
                ]
            };
            
            return testData[dongCode] || [
                {
                    "ë‹¨ì§€ëª…": "í…ŒìŠ¤íŠ¸ì•„íŒŒíŠ¸",
                    "ë‹¨ì§€ê¸°ë³¸ì¼ë ¨ë²ˆí˜¸": "999999",
                    "ì„¸ëŒ€ìˆ˜": 500,
                    "ì¤€ê³µë…„ë„": "2010",
                    "ë§¤ë§¤í‰ê· ê°€": "100000"
                }
            ];
        }

        // ì‹œì„¸ ì¡°íšŒ
        async function searchPrices() {
            const complexIndex = document.getElementById('complex-select').value;
            
            if (!complexIndex || !currentComplexes[complexIndex]) {
                showError('ë‹¨ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            selectedComplex = currentComplexes[complexIndex];
            
            try {
                showLoading();
                console.log(`ğŸ’° ì‹œì„¸ ì¡°íšŒ ì‹œì‘: ${selectedComplex.ë‹¨ì§€ëª…}`);
                
                let detailData = null;
                
                try {
                    // ì‹¤ì œ API ì‹œë„
                    const detailResponse = await fetch(`https://api.kbland.kr/land-complex/complex/mpriByType?ë‹¨ì§€ê¸°ë³¸ì¼ë ¨ë²ˆí˜¸=${selectedComplex.ë‹¨ì§€ê¸°ë³¸ì¼ë ¨ë²ˆí˜¸}`, {
                        headers: {
                            'Accept': 'application/json, text/plain, */*',
                            'Origin': 'https://kbland.kr',
                            'Referer': 'https://kbland.kr/'
                        }
                    });
                    
                    if (detailResponse.ok) {
                        const data = await detailResponse.json();
                        detailData = data.dataBody?.data;
                        console.log('âœ… ì‹¤ì œ API ì‹œì„¸ ì¡°íšŒ ì„±ê³µ');
                    }
                } catch (apiError) {
                    console.log('âš ï¸ API í˜¸ì¶œ ì‹¤íŒ¨, í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚¬ìš©');
                    detailData = getTestPriceData(selectedComplex.ë‹¨ì§€ê¸°ë³¸ì¼ë ¨ë²ˆí˜¸);
                    console.log('ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œì„¸ ë°ì´í„° ì‚¬ìš©');
                }
                
                displayPriceDetails(selectedComplex, detailData);
                
            } catch (error) {
                console.error('âŒ ì‹œì„¸ ì¡°íšŒ ì „ì²´ ì˜¤ë¥˜:', error);
                showError('ì‹œì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í…ŒìŠ¤íŠ¸ ì‹œì„¸ ë°ì´í„° ìƒì„±
        function getTestPriceData(complexId) {
            const testPriceData = {
                "341954": [ // ëŒ€ì¹˜ì•„ì´íŒŒí¬
                    {
                        "ê³µê¸‰ë©´ì ": "84.93",
                        "ê³µê¸‰ë©´ì í‰N": "25.7",
                        "ì£¼íƒí˜•íƒ€ì…ë‚´ìš©": "84Aí˜•",
                        "ë§¤ë§¤ì¼ë°˜ê±°ë˜ê°€": "148750"
                    },
                    {
                        "ê³µê¸‰ë©´ì ": "84.93", 
                        "ê³µê¸‰ë©´ì í‰N": "25.7",
                        "ì£¼íƒí˜•íƒ€ì…ë‚´ìš©": "84Bí˜•",
                        "ë§¤ë§¤ì¼ë°˜ê±°ë˜ê°€": "151250"
                    },
                    {
                        "ê³µê¸‰ë©´ì ": "114.93",
                        "ê³µê¸‰ë©´ì í‰N": "34.8", 
                        "ì£¼íƒí˜•íƒ€ì…ë‚´ìš©": "114Aí˜•",
                        "ë§¤ë§¤ì¼ë°˜ê±°ë˜ê°€": "192500"
                    },
                    {
                        "ê³µê¸‰ë©´ì ": "114.93",
                        "ê³µê¸‰ë©´ì í‰N": "34.8",
                        "ì£¼íƒí˜•íƒ€ì…ë‚´ìš©": "114Bí˜•", 
                        "ë§¤ë§¤ì¼ë°˜ê±°ë˜ê°€": "198750"
                    },
                    {
                        "ê³µê¸‰ë©´ì ": "134.85",
                        "ê³µê¸‰ë©´ì í‰N": "40.8",
                        "ì£¼íƒí˜•íƒ€ì…ë‚´ìš©": "134Aí˜•",
                        "ë§¤ë§¤ì¼ë°˜ê±°ë˜ê°€": "235000"
                    }
                ]
            };
            
            return testPriceData[complexId] || [
                {
                    "ê³µê¸‰ë©´ì ": "84.0",
                    "ê³µê¸‰ë©´ì í‰N": "25.4",
                    "ì£¼íƒí˜•íƒ€ì…ë‚´ìš©": "84í˜•",
                    "ë§¤ë§¤ì¼ë°˜ê±°ë˜ê°€": "100000"
                }
            ];
        }

        // ì‹œì„¸ ìƒì„¸ ì •ë³´ í‘œì‹œ
        function displayPriceDetails(complex, detailData) {
            const section = document.getElementById('price-detail-section');
            const contentElement = document.getElementById('price-detail-content');
            
            let content = '';
            
            if (detailData && Array.isArray(detailData) && detailData.length > 0) {
                // ë§¤ë§¤ê°€ê°€ ìˆëŠ” ë°ì´í„°ë§Œ í•„í„°ë§
                const filteredData = detailData.filter(item => {
                    const price = item.ë§¤ë§¤ì¼ë°˜ê±°ë˜ê°€ || item.ë§¤ë§¤ê°€ || item.ë§¤ë§¤í‰ê· ê°€;
                    return price && price !== '' && price !== '-' && price !== 'N/A' && price !== 0;
                });
                
                if (filteredData.length > 0) {
                    // í‰í˜•ë³„ ì‹œì„¸ ë°ì´í„° ì •ë ¬
                    const sortedDetailData = [...filteredData].sort((a, b) => {
                        const pyeongA = parseFloat(a.ê³µê¸‰ë©´ì í‰N || a.í‰ìˆ˜ || 0);
                        const pyeongB = parseFloat(b.ê³µê¸‰ë©´ì í‰N || b.í‰ìˆ˜ || 0);
                        
                        // 1ì°¨: í‰ìˆ˜ ìˆœìœ¼ë¡œ ì •ë ¬
                        if (pyeongA !== pyeongB) {
                            return pyeongA - pyeongB;
                        }
                        
                        // 2ì°¨: ê°™ì€ í‰ìˆ˜ì´ë©´ ì£¼íƒí˜•íƒ€ì…ë‚´ìš©ì„ ì•ŒíŒŒë²³+ìˆ«ììˆœìœ¼ë¡œ ì •ë ¬
                        const typeA = (a.ì£¼íƒí˜•íƒ€ì…ë‚´ìš© || a.íƒ€ì… || a.ì£¼íƒí˜• || '').toString().trim();
                        const typeB = (b.ì£¼íƒí˜•íƒ€ì…ë‚´ìš© || b.íƒ€ì… || b.ì£¼íƒí˜• || '').toString().trim();
                        
                        // íƒ€ì…ì—ì„œ ì•ŒíŒŒë²³ê³¼ ìˆ«ì ë¶„ë¦¬í•´ì„œ ì •ë ¬
                        const parseType = (type) => {
                            // ì•ŒíŒŒë²³ê³¼ ìˆ«ìë¥¼ ë¶„ë¦¬í•˜ëŠ” ì •ê·œì‹
                            const match = type.match(/([A-Za-z]*)(\d*)(.*)/);
                            return {
                                letter: match[1] || '',
                                number: parseInt(match[2]) || 0,
                                rest: match[3] || ''
                            };
                        };
                        
                        const parsedA = parseType(typeA);
                        const parsedB = parseType(typeB);
                        
                        // ë¨¼ì € ì•ŒíŒŒë²³ìœ¼ë¡œ ë¹„êµ
                        const letterCompare = parsedA.letter.localeCompare(parsedB.letter);
                        if (letterCompare !== 0) {
                            return letterCompare;
                        }
                        
                        // ì•ŒíŒŒë²³ì´ ê°™ìœ¼ë©´ ìˆ«ìë¡œ ë¹„êµ
                        if (parsedA.number !== parsedB.number) {
                            return parsedA.number - parsedB.number;
                        }
                        
                        // ë‚˜ë¨¸ì§€ ë¶€ë¶„ìœ¼ë¡œ ë¹„êµ
                        return parsedA.rest.localeCompare(parsedB.rest);
                    });
                    
                    content += `
                        <h4 style="margin-bottom: 15px; color: #1f2937;">ğŸ’° í‰í˜•ë³„ ë§¤ë§¤ ì‹œì„¸</h4>
                        <div style="overflow-x: auto;">
                            <table class="price-table">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>ë©´ì (mÂ²)</th>
                                        <th>í‰ìˆ˜</th>
                                        <th>íƒ€ì…</th>
                                        <th>ë§¤ë§¤ê°€</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    sortedDetailData.slice(0, 20).forEach((item, index) => {
                        const area = item.ê³µê¸‰ë©´ì  || item.ë©´ì  || '-';
                        const pyeong = item.ê³µê¸‰ë©´ì í‰N || item.í‰ìˆ˜ || '-';
                        const type = item.ì£¼íƒí˜•íƒ€ì…ë‚´ìš© || item.íƒ€ì… || item.ì£¼íƒí˜• || '-';
                        const price = item.ë§¤ë§¤ì¼ë°˜ê±°ë˜ê°€ || item.ë§¤ë§¤ê°€ || item.ë§¤ë§¤í‰ê· ê°€ || '-';
                        
                        content += `
                            <tr style="cursor: pointer;" onclick="openInsuranceModal('${price}', '${area}', '${pyeong}', '${type}')" onmouseover="this.style.backgroundColor='#f3f4f6'" onmouseout="this.style.backgroundColor=''">
                                <td>${index + 1}</td>
                                <td>${area}</td>
                                <td>${pyeong}</td>
                                <td>${type}</td>
                                <td><strong>${formatPrice(price)}</strong></td>
                            </tr>
                        `;
                    });
                    
                    content += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    if (sortedDetailData.length > 20) {
                        content += `<p style="text-align: center; margin-top: 15px; color: #6b7280;">... ì™¸ ${sortedDetailData.length - 20}ê°œ íƒ€ì… ë” ìˆìŒ</p>`;
                    }
                } else {
                    content += `
                        <div class="error-message">
                            ìƒì„¸ ì‹œì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ì •ë³´ë§Œ í‘œì‹œë©ë‹ˆë‹¤.
                        </div>
                    `;
                }
            } else {
                content += `
                    <div class="error-message">
                        ìƒì„¸ ì‹œì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ì •ë³´ë§Œ í‘œì‹œë©ë‹ˆë‹¤.
                    </div>
                `;
            }
            
            contentElement.innerHTML = content;
            section.classList.add('show');
            
            section.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // ë³´ì¦ë³´í—˜ í™•ì¸ ëª¨ë‹¬ ì—´ê¸°
        function openInsuranceModal(price, area, pyeong, type) {
            if (!price || price === '-') {
                showError('ê°€ê²© ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            selectedPriceValue = parseNumericPrice(price);
            
            if (selectedPriceValue <= 0) {
                showError('ì˜¬ë°”ë¥¸ ê°€ê²© ì •ë³´ê°€ ì•„ë‹™ë‹ˆë‹¤.');
                return;
            }
            
            const modalPrice = document.getElementById('modal-selected-price');
            modalPrice.textContent = `ì„ íƒëœ ë§¤ë§¤ê°€: ${formatPrice(selectedPriceValue)}`;
            
            const modalInfo = document.getElementById('modal-property-info');
            modalInfo.textContent = `ë©´ì : ${area}mÂ² | í‰ìˆ˜: ${pyeong}í‰ | íƒ€ì…: ${type}`;
            
            const depositInput = document.getElementById('deposit-input');
            const loanInput = document.getElementById('loan-input');
            
            depositInput.value = '';
            loanInput.value = '';
            document.getElementById('loan-result').style.display = 'none';
            document.getElementById('deposit-display').textContent = '';
            document.getElementById('loan-display').textContent = '';
            
            // ì‹¤ì‹œê°„ ê¸ˆì•¡ í‘œì‹œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            depositInput.addEventListener('input', updateDepositDisplay);
            loanInput.addEventListener('input', updateLoanDisplay);
            
            document.getElementById('loan-check-modal').classList.add('show');
        }

        // ë³´ì¦ê¸ˆ ì‹¤ì‹œê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateDepositDisplay() {
            const depositInput = document.getElementById('deposit-input');
            const depositDisplay = document.getElementById('deposit-display');
            const value = parseFloat(depositInput.value) || 0;
            
            if (value > 0) {
                depositDisplay.textContent = `ğŸ’° ${formatPrice(value)}`;
            } else {
                depositDisplay.textContent = '';
            }
        }

        // ìœµìê¸ˆ ì‹¤ì‹œê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateLoanDisplay() {
            const loanInput = document.getElementById('loan-input');
            const loanDisplay = document.getElementById('loan-display');
            const value = parseFloat(loanInput.value) || 0;
            
            if (value > 0) {
                loanDisplay.textContent = `ğŸ¦ ${formatPrice(value)}`;
            } else {
                loanDisplay.textContent = '';
            }
        }

        // ëŒ€ì¶œ í™•ì¸ ëª¨ë‹¬ ë‹«ê¸°
        function closeLoanModal() {
            document.getElementById('loan-check-modal').classList.remove('show');
        }
        // ë³´ì¦ë³´í—˜ ê°€ì…ì—¬ë¶€ í™•ì¸
        async function checkInsuranceEligibility() {
            const depositInput = document.getElementById('deposit-input');
            const loanInput = document.getElementById('loan-input');
            const resultDiv = document.getElementById('loan-result');
            
            const deposit = parseFloat(depositInput.value) || 0;  // ë§Œì› ë‹¨ìœ„
            const loan = parseFloat(loanInput.value) || 0;        // ë§Œì› ë‹¨ìœ„
            
            if (deposit <= 0 && loan <= 0) {
                showModalError('ë³´ì¦ê¸ˆ ë˜ëŠ” ìœµìê¸ˆì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë§¤ë§¤ê°€ë¥¼ ë§Œì› ë‹¨ìœ„ë¡œ ë³€í™˜
            const salePriceWon = selectedPriceValue; // ì´ë¯¸ ë§Œì› ë‹¨ìœ„
            const totalAmount = deposit + loan;
            const loanRatio = (loan / salePriceWon) * 100; // ìœµìê¸ˆ ë¹„ìœ¨
            const totalRatio = (totalAmount / salePriceWon) * 100; // ì´ ë¹„ìœ¨
            
            // HUG ë³´ì¦ë³´í—˜ ì¡°ê±´ í™•ì¸ (ì–µì› ë‹¨ìœ„ë¡œ ë³€í™˜í•´ì„œ ì²´í¬)
            const hugCondition1 = loanRatio <= 60; // ìœµìê¸ˆ 60% ì´ë‚´
            const hugCondition2 = totalRatio <= 90; // ì´í•© 90% ì´ë‚´
            const hugCondition3 = deposit <= 70000; // ë³´ì¦ê¸ˆ 7ì–µ ì´í•˜ (7ì–µ = 70000ë§Œì›)
            const hugEligible = hugCondition1 && hugCondition2 && hugCondition3;
            
            // SGIì„œìš¸ë³´ì¦ ì¡°ê±´ í™•ì¸
            const sgiCondition1 = totalRatio <= 100; // ì´í•© 100% ì´ë‚´
            const sgiEligible = sgiCondition1;
            
            let resultHtml = '';
            let resultClass = '';
            
            if (hugEligible && sgiEligible) {
                // ë‘˜ ë‹¤ ê°€ëŠ¥í•œ ê²½ìš° - "ë³´ì¦ë³´í—˜ ê°€ëŠ¥"ìœ¼ë¡œ í‘œì‹œ
                resultClass = 'success';
                resultHtml = `
                    <div class="result-title">âœ… ë³´ì¦ë³´í—˜ ê°€ëŠ¥</div>
                    <div class="result-details">
                        <p><strong>ë§¤ë§¤ê°€:</strong> ${formatPrice(salePriceWon)}</p>
                        <p><strong>ë³´ì¦ê¸ˆ:</strong> ${formatPrice(deposit)}</p>
                        <p><strong>ìœµìê¸ˆ:</strong> ${formatPrice(loan)} (${loanRatio.toFixed(1)}%)</p>
                        <p><strong>ì´ ê¸ˆì•¡:</strong> ${formatPrice(totalAmount)} (${totalRatio.toFixed(1)}%)</p>
                        <hr style="margin: 10px 0; border: none; border-top: 1px solid #e5e7eb;">
                        
                        <div style="background: #f0fdf4; padding: 12px; border-radius: 8px; margin-bottom: 10px;">
                            <p style="color: #059669; font-weight: 600;">ğŸ›ï¸ HUG(ì£¼íƒë„ì‹œë³´ì¦ê³µì‚¬) ê°€ëŠ¥</p>
                            <div style="font-size: 0.85rem; margin-top: 5px; color: #374151;">
                                <p>âœ… ìœµìê¸ˆ ${loanRatio.toFixed(1)}% (60% ì´ë‚´)</p>
                                <p>âœ… ì´ ê¸ˆì•¡ ${totalRatio.toFixed(1)}% (90% ì´ë‚´)</p>
                                <p>âœ… ë³´ì¦ê¸ˆ ${formatPrice(deposit)} (7ì–µ ì´í•˜)</p>
                            </div>
                        </div>
                        
                        <div style="background: #eff6ff; padding: 12px; border-radius: 8px;">
                            <p style="color: #2563eb; font-weight: 600;">ğŸ¢ SGIì„œìš¸ë³´ì¦ ê°€ëŠ¥</p>
                            <div style="font-size: 0.85rem; margin-top: 5px; color: #374151;">
                                <p>âœ… ì´ ê¸ˆì•¡ ${totalRatio.toFixed(1)}% (100% ì´ë‚´)</p>
                                <p>âœ… ë³´ì¦ê¸ˆ í•œë„ ì œí•œ ì—†ìŒ</p>
                            </div>
                        </div>
                        
                        <p style="font-size: 0.85rem; margin-top: 10px; color: #6b7280;">â€» ë‘ ë³´ì¦ë³´í—˜ ëª¨ë‘ ì´ìš© ê°€ëŠ¥í•˜ë¯€ë¡œ ì¡°ê±´ì„ ë¹„êµí•´ì„œ ì„ íƒí•˜ì„¸ìš”.</p>
                    </div>
                `;
            } else if (hugEligible) {
                // HUGë§Œ ê°€ëŠ¥í•œ ê²½ìš° - "ë³´ì¦ë³´í—˜ ê°€ëŠ¥"ìœ¼ë¡œ í‘œì‹œ
                resultClass = 'success';
                resultHtml = `
                    <div class="result-title">âœ… ë³´ì¦ë³´í—˜ ê°€ëŠ¥</div>
                    <div class="result-details">
                        <p><strong>ë§¤ë§¤ê°€:</strong> ${formatPrice(salePriceWon)}</p>
                        <p><strong>ë³´ì¦ê¸ˆ:</strong> ${formatPrice(deposit)}</p>
                        <p><strong>ìœµìê¸ˆ:</strong> ${formatPrice(loan)} (${loanRatio.toFixed(1)}%)</p>
                        <p><strong>ì´ ê¸ˆì•¡:</strong> ${formatPrice(totalAmount)} (${totalRatio.toFixed(1)}%)</p>
                        <hr style="margin: 10px 0; border: none; border-top: 1px solid #e5e7eb;">
                        
                        <div style="background: #f0fdf4; padding: 12px; border-radius: 8px;">
                            <p style="color: #059669; font-weight: 600;">ğŸ›ï¸ HUG(ì£¼íƒë„ì‹œë³´ì¦ê³µì‚¬) ê°€ëŠ¥</p>
                            <div style="font-size: 0.85rem; margin-top: 5px; color: #374151;">
                                <p>âœ… ìœµìê¸ˆ ${loanRatio.toFixed(1)}% (60% ì´ë‚´)</p>
                                <p>âœ… ì´ ê¸ˆì•¡ ${totalRatio.toFixed(1)}% (90% ì´ë‚´)</p>
                                <p>âœ… ë³´ì¦ê¸ˆ ${formatPrice(deposit)} (7ì–µ ì´í•˜)</p>
                            </div>
                        </div>
                        
                        <p style="font-size: 0.85rem; margin-top: 10px; color: #6b7280;">â€» SGIì„œìš¸ë³´ì¦ì€ ì´ ê¸ˆì•¡ì´ 100%ë¥¼ ì´ˆê³¼í•˜ì—¬ ì´ìš© ë¶ˆê°€í•©ë‹ˆë‹¤.</p>
                    </div>
                `;
            } else if (sgiEligible) {
                // SGIë§Œ ê°€ëŠ¥í•œ ê²½ìš° - "SGIì„œìš¸ë³´ì¦ë§Œ ê°€ëŠ¥"ìœ¼ë¡œ í‘œì‹œ
                resultClass = 'warning';
                resultHtml = `
                    <div class="result-title">âš ï¸ SGIì„œìš¸ë³´ì¦ë§Œ ê°€ëŠ¥</div>
                    <div class="result-details">
                        <p><strong>ë§¤ë§¤ê°€:</strong> ${formatPrice(salePriceWon)}</p>
                        <p><strong>ë³´ì¦ê¸ˆ:</strong> ${formatPrice(deposit)}</p>
                        <p><strong>ìœµìê¸ˆ:</strong> ${formatPrice(loan)} (${loanRatio.toFixed(1)}%)</p>
                        <p><strong>ì´ ê¸ˆì•¡:</strong> ${formatPrice(totalAmount)} (${totalRatio.toFixed(1)}%)</p>
                        <hr style="margin: 10px 0; border: none; border-top: 1px solid #e5e7eb;">
                        
                        <div style="background: #eff6ff; padding: 12px; border-radius: 8px;">
                            <p style="color: #2563eb; font-weight: 600;">ğŸ¢ SGIì„œìš¸ë³´ì¦ ê°€ëŠ¥</p>
                            <div style="font-size: 0.85rem; margin-top: 5px; color: #374151;">
                                <p>âœ… ì´ ê¸ˆì•¡ ${totalRatio.toFixed(1)}% (100% ì´ë‚´)</p>
                                <p>âœ… ë³´ì¦ê¸ˆ í•œë„ ì œí•œ ì—†ìŒ</p>
                            </div>
                        </div>
                        
                        <div style="background: #fef2f2; padding: 12px; border-radius: 8px; margin-top: 10px;">
                            <p style="color: #dc2626; font-weight: 600;">âŒ HUG ë³´ì¦ë³´í—˜ ë¶ˆê°€ ì‚¬ìœ :</p>
                            <div style="font-size: 0.85rem; margin-top: 5px; color: #374151;">
                                ${!hugCondition1 ? `<p>â€¢ ìœµìê¸ˆ ${loanRatio.toFixed(1)}% (60% ì´ˆê³¼)</p>` : ''}
                                ${!hugCondition2 ? `<p>â€¢ ì´ ê¸ˆì•¡ ${totalRatio.toFixed(1)}% (90% ì´ˆê³¼)</p>` : ''}
                                ${!hugCondition3 ? `<p>â€¢ ë³´ì¦ê¸ˆ ${formatPrice(deposit)} (7ì–µ ì´ˆê³¼)</p>` : ''}
                            </div>
                        </div>
                        
                        <p style="font-size: 0.85rem; margin-top: 10px; color: #ea580c;">â€» SGIì„œìš¸ë³´ì¦ìœ¼ë¡œë§Œ ë³´ì¦ë³´í—˜ ê°€ì…ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                    </div>
                `;
            } else {
                // ë‘˜ ë‹¤ ë¶ˆê°€ëŠ¥í•œ ê²½ìš°
                resultClass = 'error';
                resultHtml = `
                    <div class="result-title">âŒ ë³´ì¦ë³´í—˜ ê°€ì… ë¶ˆê°€</div>
                    <div class="result-details">
                        <p><strong>ë§¤ë§¤ê°€:</strong> ${formatPrice(salePriceWon)}</p>
                        <p><strong>ë³´ì¦ê¸ˆ:</strong> ${formatPrice(deposit)}</p>
                        <p><strong>ìœµìê¸ˆ:</strong> ${formatPrice(loan)} (${loanRatio.toFixed(1)}%)</p>
                        <p><strong>ì´ ê¸ˆì•¡:</strong> ${formatPrice(totalAmount)} (${totalRatio.toFixed(1)}%)</p>
                        <hr style="margin: 10px 0; border: none; border-top: 1px solid #e5e7eb;">
                        <div style="background: #fef2f2; padding: 12px; border-radius: 8px; margin-bottom: 10px;">
                            <p style="color: #dc2626; font-weight: 600;">âŒ HUG(ì£¼íƒë„ì‹œë³´ì¦ê³µì‚¬) ë¶ˆê°€ ì‚¬ìœ :</p>
                            <div style="font-size: 0.85rem; margin-top: 5px;">
                                ${!hugCondition1 ? `<p>â€¢ ìœµìê¸ˆ ${loanRatio.toFixed(1)}% (60% ì´ˆê³¼)</p>` : ''}
                                ${!hugCondition2 ? `<p>â€¢ ì´ ê¸ˆì•¡ ${totalRatio.toFixed(1)}% (90% ì´ˆê³¼)</p>` : ''}
                                ${!hugCondition3 ? `<p>â€¢ ë³´ì¦ê¸ˆ ${formatPrice(deposit)} (7ì–µ ì´ˆê³¼)</p>` : ''}
                            </div>
                        </div>
                        <div style="background: #fef2f2; padding: 12px; border-radius: 8px;">
                            <p style="color: #dc2626; font-weight: 600;">âŒ SGIì„œìš¸ë³´ì¦ ë¶ˆê°€ ì‚¬ìœ :</p>
                            <div style="font-size: 0.85rem; margin-top: 5px;">
                                <p>â€¢ ì´ ê¸ˆì•¡ ${totalRatio.toFixed(1)}% (100% ì´ˆê³¼)</p>
                            </div>
                        </div>
                        <div style="font-size: 0.85rem; margin-top: 15px; color: #374151; background: #f8fafc; padding: 10px; border-radius: 6px;">
                            <p><strong>ğŸ“‹ ê°€ì… ì¡°ê±´ ìš”ì•½:</strong></p>
                            <p><strong>HUG:</strong> ìœµìê¸ˆ 60% ì´ë‚´ + ì´ê¸ˆì•¡ 90% ì´ë‚´ + ë³´ì¦ê¸ˆ 7ì–µ ì´í•˜</p>
                            <p><strong>SGI:</strong> ì´ê¸ˆì•¡ 100% ì´ë‚´ (ë³´ì¦ê¸ˆ í•œë„ ì—†ìŒ)</p>
                        </div>
                        <p style="font-size: 0.85rem; margin-top: 10px; font-weight: 600; color: #dc2626;">ğŸ’¡ ë³´ì¦ê¸ˆì´ë‚˜ ìœµìê¸ˆì„ ì¡°ì •í•´ë³´ì„¸ìš”.</p>
                    </div>
                `;
            }
            
            resultDiv.className = `result-section ${resultClass}`;
            resultDiv.innerHTML = resultHtml;
            resultDiv.style.display = 'block';
            
            // âœ¨ Notion Databaseì— ë‹¨ì§€ëª…ë§Œ ì €ì¥ (ìƒˆë¡œ ì¶”ê°€ëœ ë¶€ë¶„)
            await saveComplexToNotion(selectedComplex?.ë‹¨ì§€ëª… || 'ì•Œ ìˆ˜ ì—†ëŠ” ë‹¨ì§€');
        }

        // Notion Databaseì— ì „ì²´ ë°ì´í„° ì €ì¥ í•¨ìˆ˜ (ì—…ë°ì´íŠ¸)
        async function saveComplexToNotion(complexName) {
            try {
                console.log('ğŸ’¾ Notion ì €ì¥ ì‹œì‘:', complexName);
                
                // í˜„ì¬ ëª¨ë‹¬ì—ì„œ ì •ë³´ ì¶”ì¶œ
                const modalInfo = document.getElementById('modal-property-info');
                const text = modalInfo ? modalInfo.textContent : '';
                
                const areaMatch = text.match(/ë©´ì : ([^|]+)/);
                const pyeongMatch = text.match(/í‰ìˆ˜: ([^|]+)/);
                const typeMatch = text.match(/íƒ€ì…: (.+)$/);
                
                const area = areaMatch ? areaMatch[1].trim() : '';
                const pyeong = pyeongMatch ? pyeongMatch[1].trim().replace('í‰', '') : '';
                const type = typeMatch ? typeMatch[1].trim() : '';
                
                // ì…ë ¥ëœ ë³´ì¦ê¸ˆ/ìœµìê¸ˆ ê°€ì ¸ì˜¤ê¸°
                const depositInput = document.getElementById('deposit-input');
                const loanInput = document.getElementById('loan-input');
                const deposit = parseFloat(depositInput?.value) || 0;
                const loan = parseFloat(loanInput?.value) || 0;
                
                // ê²°ê³¼ íŒë‹¨
                const salePriceWon = selectedPriceValue;
                const totalAmount = deposit + loan;
                const loanRatio = (loan / salePriceWon) * 100;
                const totalRatio = (totalAmount / salePriceWon) * 100;
                
                const hugEligible = loanRatio <= 60 && totalRatio <= 90 && deposit <= 70000;
                const sgiEligible = totalRatio <= 100;
                
                let result = 'impossible';
                if (hugEligible && sgiEligible) {
                    result = 'both_possible';
                } else if (hugEligible) {
                    result = 'both_possible'; // HUGë§Œ ê°€ëŠ¥í•´ë„ "ê°€ëŠ¥"ìœ¼ë¡œ í‘œì‹œ
                } else if (sgiEligible) {
                    result = 'sgi_only';
                }
                
                const response = await fetch('/api/save-complex', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        complexName: complexName,
                        area: area,
                        pyeong: pyeong,
                        type: type,
                        salePrice: salePriceWon, // ë§Œì› ë‹¨ìœ„
                        deposit: deposit, // ë§Œì› ë‹¨ìœ„
                        loan: loan, // ë§Œì› ë‹¨ìœ„
                        result: result
                    })
                });
                
                console.log('ğŸ“¡ API ì‘ë‹µ ìƒíƒœ:', response.status);
                
                const resultData = await response.json();
                console.log('ğŸ“‹ API ì‘ë‹µ ë°ì´í„°:', resultData);
                
                if (resultData.success) {
                    console.log('âœ… ì „ì²´ ë°ì´í„° ì €ì¥ ì„±ê³µ:', resultData.savedData);
                } else {
                    console.error('âš ï¸ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', resultData.message);
                    console.error('ìƒì„¸ ì˜¤ë¥˜:', resultData.error);
                }
                
            } catch (error) {
                console.error('âŒ ë°ì´í„° ì €ì¥ ì˜¤ë¥˜:', error);
                console.error('ì˜¤ë¥˜ ìƒì„¸:', error.message);
            }
        }
        // ìˆ«ì ê°€ê²©ìœ¼ë¡œ ë³€í™˜
        function parseNumericPrice(price) {
            if (typeof price === 'number') {
                return price;
            }
            
            if (typeof price === 'string') {
                const numStr = price.replace(/[^0-9.]/g, '');
                const num = parseFloat(numStr);
                
                if (isNaN(num)) return 0;
                
                if (price.includes('ì–µ')) {
                    return num * 10000;
                } else if (price.includes('ë§Œ')) {
                    return num;
                } else {
                    return num;
                }
            }
            
            return 0;
        }

        // ì–µì› ë‹¨ìœ„ë¡œ í¬ë§·íŒ…
        function formatPriceEok(price) {
            if (price === 0) return '0ì–µ';
            
            if (price === Math.floor(price)) {
                return `${Math.floor(price)}ì–µ`;
            } else {
                return `${price.toFixed(1)}ì–µ`;
            }
        }

        // ê°€ê²© í¬ë§·íŒ…
        function formatPrice(price) {
            if (!price || price === '' || price === 0) {
                return '-';
            }
            
            try {
                let priceNum;
                
                if (typeof price === 'string') {
                    const cleanPrice = price.replace(/[,\s]/g, '');
                    if (!/^\d*\.?\d+$/.test(cleanPrice)) {
                        return price;
                    }
                    priceNum = parseFloat(cleanPrice);
                } else if (typeof price === 'number') {
                    priceNum = price;
                } else {
                    return price.toString();
                }
                
                if (priceNum >= 10000) {
                    const eokValue = priceNum / 10000;
                    if (eokValue === Math.floor(eokValue)) {
                        return `${Math.floor(eokValue)}ì–µ`;
                    } else {
                        return `${eokValue.toString()}ì–µ`;
                    }
                } else {
                    if (priceNum === Math.floor(priceNum)) {
                        return `${Math.floor(priceNum).toLocaleString()}ë§Œì›`;
                    } else {
                        return `${priceNum.toString()}ë§Œì›`;
                    }
                }
            } catch (error) {
                return price.toString();
            }
        }

        // ë¡œë”© í‘œì‹œ
        function showLoading() {
            const section = document.getElementById('price-detail-section');
            const contentElement = document.getElementById('price-detail-content');
            
            contentElement.innerHTML = '<div class="loading">ì‹œì„¸ ì •ë³´ë¥¼ ì¡°íšŒí•˜ê³  ìˆìŠµë‹ˆë‹¤</div>';
            section.classList.add('show');
        }

        // ê²°ê³¼ ìˆ¨ê¸°ê¸°
        function hideResults() {
            document.getElementById('results-section').classList.remove('show');
            document.getElementById('price-detail-section').classList.remove('show');
        }

        // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
        function showError(message) {
            const section = document.getElementById('price-detail-section');
            const contentElement = document.getElementById('price-detail-content');
            
            contentElement.innerHTML = `<div class="error-message">${message}</div>`;
            section.classList.add('show');
        }

        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeLoanModal();
            }
        });

        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
        document.getElementById('loan-check-modal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeLoanModal();
            }
        });
    </script>
</body>
</html>
